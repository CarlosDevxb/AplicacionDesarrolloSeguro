<div class="login-wrapper">
  <div class="login-form-container">
    <img src="assets/CHAFATEC.png" alt="CHAFATEC Logo" class="logo">
    <h2>Establecer Nueva Contraseña</h2>
    <p class="subtitle">Crea una contraseña segura para acceder a tu cuenta.</p>

    <!-- Mensaje de error si el token no es válido (se muestra en lugar del formulario) -->
    <div *ngIf="!showForm && errorMessage" class="token-error-message">
      <i class="fas fa-exclamation-triangle"></i>
      <h3>Enlace no válido</h3>
      <p>{{ errorMessage }}</p>
    </div>

    <form [formGroup]="passwordForm" (ngSubmit)="onSubmit()" *ngIf="showForm && !successMessage">

      <div class="form-group">
        <label for="password">Nueva Contraseña</label>
        <div class="input-group">
          <i class="fa-solid fa-lock"></i>
          <input id="password" type="password" formControlName="password" placeholder="Mínimo 6 caracteres">
        </div>
        <div *ngIf="passwordForm.get('password')?.invalid && passwordForm.get('password')?.touched" class="error-text">
          <small *ngIf="passwordForm.get('password')?.errors?.['required']">La contraseña es obligatoria.</small>
          <small *ngIf="passwordForm.get('password')?.errors?.['minlength']">Debe tener al menos 6 caracteres.</small>
        </div>
      </div>

      <div class="form-group">
        <label for="confirmPassword">Confirmar Contraseña</label>
        <div class="input-group">
          <i class="fa-solid fa-lock"></i>
          <input id="confirmPassword" type="password" formControlName="confirmPassword" placeholder="Repite tu contraseña">
        </div>
        <div *ngIf="passwordForm.get('confirmPassword')?.errors?.['mustMatch'] && passwordForm.get('confirmPassword')?.touched" class="error-text">
          <small>Las contraseñas no coinciden.</small>
        </div>
      </div>

      <div *ngIf="errorMessage" class="error-message">
        {{ errorMessage }}
      </div>

      <button type="submit" [disabled]="passwordForm.invalid || isLoading">
        <span *ngIf="!isLoading">Guardar Contraseña</span>
        <span *ngIf="isLoading">Guardando...</span>
      </button>
    </form>

    <!-- Mensaje de éxito -->
    <div *ngIf="successMessage" class="success-message">
      <i class="fas fa-check-circle"></i>
      <h3>¡Éxito!</h3>
      <p>{{ successMessage }}</p>
      <a routerLink="/login" class="login-link">Ir al Login ahora</a>
    </div>

    <!-- Marca de agua (igual que en el login) -->
    <div class="watermark">
      <img src="assets/cuchiputlogo2.png" alt="Cuchipu Entertainment Logo">
      <span>CHAFATEC by Cuchipu Entertainment</span>
    </div>

  </div>
</div>