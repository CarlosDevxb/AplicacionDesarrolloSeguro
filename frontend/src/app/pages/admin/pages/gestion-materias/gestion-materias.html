<div class="management-container">
  <header class="management-header">
    <h2>Gestión de Materias</h2>
    <p>Crea nuevas materias y asígnalas a las carreras correspondientes.</p>
  </header>

  <!-- Bloque para Crear Materia -->
  <div class="collapsible-block">
    <div class="collapsible-header" (click)="showCreateBlock = !showCreateBlock">
      <h4><i class="fas fa-book"></i> Registrar Nueva Materia</h4>
      <i class="fas fa-chevron-down" [class.rotated]="showCreateBlock"></i>
    </div>
    <div class="collapsible-content" *ngIf="showCreateBlock">
      <form [formGroup]="materiaForm" (ngSubmit)="createMateria()" class="user-form">
        <div class="form-grid">
          <div class="form-group"><label for="materia-id">Clave de Materia</label><input id="materia-id" type="text" formControlName="id" placeholder="Ej: ISC-101"></div>
          <div class="form-group"><label for="materia-nombre">Nombre de la Materia</label><input id="materia-nombre" type="text" formControlName="nombre" placeholder="Ej: Cálculo Diferencial"></div>
          <div class="form-group"><label for="materia-creditos">Créditos</label><input id="materia-creditos" type="number" formControlName="creditos" placeholder="Ej: 5"></div>
          <div class="form-group"><label for="materia-semestre">Semestre</label><input id="materia-semestre" type="number" formControlName="semestre" placeholder="Ej: 1"></div>
        </div>

        <div class="form-group">
          <label>Asignar a Carreras</label>
          <div class="checkbox-grid" formArrayName="carreras">
            <div *ngFor="let carrera of carreras; let i = index" class="checkbox-item">
              <input type="checkbox" [formControlName]="i" [id]="'carrera-' + i">
              <label [for]="'carrera-' + i">{{ carrera.nombre }}</label>
            </div>
          </div>
        </div>

        <button type="submit" [disabled]="materiaForm.invalid">Crear Materia</button>
      </form>
      <div *ngIf="createMessage" class="message-box info">{{ createMessage }}</div>
    </div>
  </div>

  <!-- Bloque para Buscar y Editar -->
  <div class="collapsible-block">
    <div class="collapsible-header" (click)="showSearchBlock = !showSearchBlock">
      <h4><i class="fas fa-search"></i> Buscar y Editar Materia</h4>
      <i class="fas fa-chevron-down" [class.rotated]="showSearchBlock"></i>
    </div>
    <div class="collapsible-content" *ngIf="showSearchBlock">
      <div class="search-section">
        <input [formControl]="searchControl" type="text" placeholder="Ingresa el nombre de la materia">
        <button (click)="searchMateria()">Buscar</button>
      </div>

      <div *ngIf="searchMessage" class="message-box info">{{ searchMessage }}</div>

      <div *ngIf="searchResults.length > 0" class="search-results">
        <hr>
        <h5>Resultados de la Búsqueda</h5>
        <div *ngFor="let materia of searchResults" class="result-item">
          <div class="result-info">
            <strong>{{ materia.nombre }}</strong> (Clave: {{ materia.id }}, Créditos: {{ materia.creditos }})
            <div class="result-carreras">
              Carreras:
              <span *ngFor="let carrera of materia.Carreras" class="badge">{{ carrera.nombre }}</span>
            </div>
          </div>
          <div class="result-actions">
            <button class="btn-edit">Editar</button>
          </div>
        </div>
      </div>

    </div>
  </div>

</div>