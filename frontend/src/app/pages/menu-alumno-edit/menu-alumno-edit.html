<div class="dashboard-container fade-in" [class.sidebar-collapsed]="isSidebarCollapsed">
  <!-- Menú Lateral (Sidebar) -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <h2 class="title">Portal Alumno</h2>
    </div>

    <div class="profile-section">
      <div class="profile-picture-container">
        <img *ngIf="alumno?.foto" [src]="alumno.foto" alt="Foto de perfil" class="profile-picture-img" (error)="$event.target.src='assets/default-profile.png'">
        <i *ngIf="!alumno?.foto" class="fas fa-user-graduate"></i>
      </div>
      <div class="profile-info">
        <span class="profile-name" *ngIf="alumno">{{ alumno.nombre_completo }}</span>
        <span class="profile-role">Rol: {{ alumno?.rol | titlecase }}</span>
      </div>
    </div>

    <nav class="menu">
      <a routerLink="/alumno/dashboard" routerLinkActive="active" class="menu-item"><i class="fas fa-home"></i><span class="menu-text">Inicio</span></a>
      <a routerLink="/alumno/perfil" routerLinkActive="active" class="menu-item"><i class="fas fa-user-circle"></i><span class="menu-text">Mi Perfil</span></a>
      <a routerLink="/alumno/carrera" routerLinkActive="active" class="menu-item"><i class="fas fa-graduation-cap"></i><span class="menu-text">Mi Carrera</span></a>
      <a routerLink="/alumno/reticula" routerLinkActive="active" class="menu-item"><i class="fas fa-book"></i><span class="menu-text">Retícula</span></a>
      <a routerLink="/alumno/calificaciones" routerLinkActive="active" class="menu-item"><i class="fas fa-tasks"></i><span class="menu-text">Calificaciones</span></a>
      <a routerLink="/alumno/horario" routerLinkActive="active" class="menu-item"><i class="fas fa-calendar-alt"></i><span class="menu-text">Horario</span></a>
    </nav>

    <div class="sidebar-footer">
      <button (click)="logout()" class="menu-item logout-button">
        <i class="fas fa-sign-out-alt"></i>
        <span class="menu-text">Cerrar Sesión</span>
      </button>
    </div>
  </aside>

  <!-- Contenido Principal -->
  <main class="main-content" *ngIf="alumno">
    <header class="content-header">
      <h1>Editar Perfil</h1>
      <p>Modifica tu información personal y de contacto.</p>
    </header>

    <section class="content-area">
      <!-- Contenedor para mensajes de usuario -->
      <div *ngIf="message" class="message-box visible" [ngClass]="messageType">
        {{ message }}
      </div>

      <div class="profile-sections-grid">
        <!-- Formulario de Datos Personales -->
        <section class="seccion-form">
          <h3>Datos personales</h3>
          <p class="instrucciones">Modifica tu información personal y de contacto.</p>
          <form [formGroup]="editForm" (ngSubmit)="updateProfile()">
            <div class="form-grid">
              <div class="campo-foto">
                <div class="foto-perfil-editar">
                  <img [src]="alumno.foto || 'assets/default-profile.png'" alt="Foto de perfil" (error)="$event.target.src='assets/default-profile.png'">
                </div>
                <div>
                  <label for="foto">Fotografía <a href="#" (click)="triggerFileInput($event)">Elegir archivo</a></label>
                  <input type="file" id="foto" (change)="onFileSelected($event)" style="display: none;">
                  <p class="ayuda-foto">Sube una foto personal, de frente, con el rostro reconocible.</p>
                </div>
              </div>
              <label>Nombre completo<input type="text" formControlName="nombre_completo"></label>
              <label>Correo electrónico<input type="email" formControlName="correo"></label>
              <label>Teléfono<input type="tel" formControlName="telefono"></label>
              <label>Dirección<input type="text" formControlName="direccion" placeholder="Calle, número, colonia, etc."></label>
            </div>
            <button type="submit" class="boton-guardar" [disabled]="editForm.invalid || !editForm.dirty">Guardar Datos</button>
          </form>
        </section>

        <!-- Formulario de Contraseña -->
        <section class="seccion-form">
          <h3>Contraseña</h3>
          <form [formGroup]="passwordForm" (ngSubmit)="changePassword()">
            <div class="form-grid">
              <label>Contraseña actual<input type="password" formControlName="contrasena_actual"></label>
              <label>Nueva contraseña<input type="password" formControlName="nueva_contrasena"></label>
              <label>Confirmar nueva contraseña<input type="password" formControlName="confirmar_contrasena"></label>
            </div>
            <div *ngIf="passwordForm.errors?.['mismatch'] && passwordForm.get('confirmar_contrasena')?.touched" class="error-text">
              <small>Las nuevas contraseñas no coinciden.</small>
            </div>
            <button type="submit" class="boton-guardar" [disabled]="passwordForm.invalid">Cambiar Contraseña</button>
          </form>
        </section>
      </div>

      <div id="acciones-editar">
        <a routerLink="/alumno/perfil" class="boton-volver">Atrás</a>
      </div>
    </section>
  </main>
</div>
